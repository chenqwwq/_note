# 限流算法

---

[TOC]

---



## 概述

基础的限流算法类型：

- 信号量限流
- 漏桶算法
- 令牌桶算法
- 滑动窗口算法



## 信号量算法

**信号量算法是保证全时段共同执行的请求总数的上限值。**





## 漏桶算法

漏桶算法是在请求处理前添加一个类似漏桶的概念，桶中的水（请求）可以匀速的流出（被处理）。

漏桶算法保证的重点就是请求被匀速的处理，不会让服务一下子承载过多的请求，如果请求过多，超出漏桶容量则直接溢出（丢弃请求）。

## 令牌桶算法

令牌桶类似信号量限流算法，在请求处理前都需要拿到一个令牌（Token，Permit 等等），如果未获取到令牌则等待或者丢弃。

令牌桶优于漏桶的算法是**它可以应对突发流量的情况。**

桶中以一定的时间产生令牌，如果令牌没有被消耗则会在桶中堆积（不超过桶的上限，一般来说上限就是服务处理的上限。

## 滑动窗口算法

滑动窗口算法并不算是纯的限流算法，而是流量的统计算法。

正常的统计，如果我们统计 QPS，每秒清0，那么时间的粒度就是秒，0.5 ~ 1.5 的统计就会失去准确度，所以**使用滑动窗口算法，在希望统计的时间维度之上在增加一层。**

例如 Sentinel 中，会有分钟和秒两种时间维度的统计指标。

其中分钟的统计被分为 60s，初始化创建60个 Bucket，每个桶表示1s的数据，统计是会根据当前时间统计。

秒的统计被分为两个 500ms，初始化创建2个 Bucket。



