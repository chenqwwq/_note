# 分布式锁的实现方式



---

[TOC]

---



## 概述



**在分布式环境下，需要同步的进行可能存在于多个节点上，此时单机的 synchronized 或者 reetranlock 锁就失去了原有的作用，**

分布式的锁实现和单机锁的实现类似，**都是采用竞态资源争用的形式实现的上锁。**



将节点共有的资源做为竞态资源，获取到的节点才可以执行同步的代码。



## Redis  

Redis 实现分布式锁靠的是 SET NX EX 指令。

> NX 和 EX 分别表示在 Key 不存在时创建，并且原子性的加上过期时间。



如果 Key 此时已经存在，则表示锁已经被获取，此时 Redis 返回 false，表示上锁失败。

另外两步操作的原子性也非常关键， 如果先使用 EXISTS 判断锁是否存在，再使用 SET 就可能出现两个线程同时上锁的问题。

如果分步实现过期时间，则可能出现下一步没有完成导致锁永久存在的问题。

虽然有过期时间，但是也别忘了在执行完同步代码之后 DELETE 掉添加的锁资源。







## 数据库唯一索引





## Zookeeper



